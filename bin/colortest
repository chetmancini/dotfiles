#!/usr/bin/env bash
# shellcheck shell=bash
set -euo pipefail

# colortest: Display terminal color capabilities
#
# Shows 16 ANSI colors, 256 color palette, and truecolor gradient

print_help() {
    echo "Usage: colortest [options]"
    echo ""
    echo "Display terminal color capabilities."
    echo ""
    echo "Options:"
    echo "  --basic       Show only 16 ANSI colors"
    echo "  --256         Show only 256 color palette"
    echo "  --true        Show only truecolor gradient"
    echo "  -h, --help    Show this help message"
    echo ""
    echo "Examples:"
    echo "  colortest          # Show everything"
    echo "  colortest --true   # Just the truecolor gradient"
    exit 0
}

SHOW_BASIC=true
SHOW_256=true
SHOW_TRUE=true

while [[ $# -gt 0 ]]; do
    case "$1" in
        -h|--help)
            print_help
            ;;
        --basic)
            SHOW_256=false
            SHOW_TRUE=false
            shift
            ;;
        --256)
            SHOW_BASIC=false
            SHOW_TRUE=false
            shift
            ;;
        --true)
            SHOW_BASIC=false
            SHOW_256=false
            shift
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done

# â”€â”€ 16 ANSI colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [[ "$SHOW_BASIC" == true ]]; then
    echo "â”€â”€ 16 ANSI Colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo ""

    # Normal colors
    printf "  Normal:  "
    for i in {0..7}; do
        printf "\033[48;5;%sm  %2s  \033[0m" "$i" "$i"
    done
    echo ""

    # Bright colors
    printf "  Bright:  "
    for i in {8..15}; do
        printf "\033[48;5;%sm  %2s  \033[0m" "$i" "$i"
    done
    echo ""

    # Foreground text samples
    echo ""
    printf "  "
    for i in {0..7}; do
        printf "\033[3%smâ–„â–„\033[0m " "$i"
    done
    echo ""
    printf "  "
    for i in {0..7}; do
        printf "\033[1;3%smâ–„â–„\033[0m " "$i"
    done
    echo ""
    echo ""
fi

# â”€â”€ 256 color palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [[ "$SHOW_256" == true ]]; then
    echo "â”€â”€ 256 Color Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo ""

    # Colors 16-231 (6x6x6 cube)
    for row in $(seq 0 5); do
        printf "  "
        for col in $(seq 0 35); do
            color=$((16 + row * 36 + col))
            if [[ $color -le 231 ]]; then
                printf "\033[48;5;%sm \033[0m" "$color"
            fi
        done
        echo ""
    done
    echo ""

    # Grayscale ramp 232-255
    printf "  Grays: "
    for i in $(seq 232 255); do
        printf "\033[48;5;%sm \033[0m" "$i"
    done
    echo ""
    echo ""
fi

# â”€â”€ Truecolor gradient â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [[ "$SHOW_TRUE" == true ]]; then
    echo "â”€â”€ Truecolor (24-bit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    echo ""

    # Red gradient
    printf "  R: "
    for i in $(seq 0 4 255); do
        printf "\033[48;2;%s;0;0m \033[0m" "$i"
    done
    echo ""

    # Green gradient
    printf "  G: "
    for i in $(seq 0 4 255); do
        printf "\033[48;2;0;%s;0m \033[0m" "$i"
    done
    echo ""

    # Blue gradient
    printf "  B: "
    for i in $(seq 0 4 255); do
        printf "\033[48;2;0;0;%sm \033[0m" "$i"
    done
    echo ""

    # Rainbow
    printf "  ðŸŒˆ "
    for i in $(seq 0 3 255); do
        if [[ $i -le 85 ]]; then
            r=$((255 - i * 3))
            g=$((i * 3))
            b=0
        elif [[ $i -le 170 ]]; then
            r=0
            g=$((255 - (i - 85) * 3))
            b=$(((i - 85) * 3))
        else
            r=$(((i - 170) * 3))
            g=0
            b=$((255 - (i - 170) * 3))
        fi
        # Clamp values
        r=$((r > 255 ? 255 : r < 0 ? 0 : r))
        g=$((g > 255 ? 255 : g < 0 ? 0 : g))
        b=$((b > 255 ? 255 : b < 0 ? 0 : b))
        printf "\033[48;2;%s;%s;%sm \033[0m" "$r" "$g" "$b"
    done
    echo ""

    # Grayscale gradient
    printf "  â— "
    for i in $(seq 0 3 255); do
        printf "\033[48;2;%s;%s;%sm \033[0m" "$i" "$i" "$i"
    done
    echo ""
    echo ""

    echo "  If you see smooth gradients above, your terminal supports truecolor."
    echo "  If banded/stepped, it's falling back to 256 colors."
fi
